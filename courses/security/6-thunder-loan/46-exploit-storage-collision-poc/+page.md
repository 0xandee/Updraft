---
title: Exploit - Storage Collision - PoC
---

# Code Proving 101: An In-Depth Walkthrough in Upgrading Solidity Contracts

Welcome to our walkthrough of writing a proof-of-code for Solidity contracts. Here, we'll be outlining a detailed practice on how you can handle upgrades - an essential part of maintaining and improving smart contracts. The entire process is clear-cut, so don't be shy about getting your hands dirty with code.

### The Test Unit

Conveniently, we'll be examining a test unit called Thunderlone, which has an upgrade function we will dissect. Below we will act as the owner of Thunderlone, including deploying a new logic address and making an upgrade proxy call.

At this point, we fetch the fee before making any changes and state a new `ThunderloneUpgraded`.

![](https://cdn.videotap.com/KgYyc5GgyHgGV9f1xeiW-44.57.png)

Intriguing right? But, not so fast! Weâ€™ve missed something vital. Just before diving to that, we ought to import the upgraded protocol at the top of the test page. Here, `ThunderloneUpgraded.sol` is the Solidity script that defines our `ThunderloneUpgraded` contract.

With that code added, we now have access to the `ThunderloneUpgraded` contract we instantiated earlier.

### Handling the Upgrade

The next crucial part involves calling Thunderlone's upgrade function.

For our purpose, there's no data to call, hence the "0x". This function upgrades the proxy to the upgraded address, nifty right?

### Assertions

Once we log the fees, we come to our final part - asserting that the `feeBeforeUpgrade` indeed changed from `feeAfterUpgrade`.

This simple test will tell if there is a discrepancy in the fees, which would mean our upgrade tinkered with more than it should have, causing storage collisions.

### Running the Tests

We are now ready to run this forge test. It's pretty scary how such small changes can end up making mega alterations, right?

Keep crafting your test units as you explore the vast world of Solidity. Don't be too hard on yourself; it takes a few trial and errors before you become a pro! And remember, learning is a never-ending journey. :)

Happy testing!
