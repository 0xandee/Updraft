---
title: Exploit - Oracle Manipulation - Thunder Loan PoC
---

# Exploiting Oracles with Flash Loans

Oracles play a critical role in blockchain systems by providing external data to smart contracts. However, improperly designed oracles can lead to devastating oracle manipulation attacks. In this post, we will demonstrate an advanced oracle manipulation attack using flash loans.

## Overview

![](https://cdn.videotap.com/kM0YOBTs7t8WreMLhr2A-49.5.png)We recently audited a lending protocol called ThunderLoan that relies on a DEX called TSWAP for price feeds. By exploiting TSWAP with flash loans, we will manipulate prices and extract cheaper flash loans.

This is an extremely advanced attack that combines:

- Flash loans
- Oracle manipulation
- Arbitrage bots
- DEX price manipulation

## Exploiting the Oracle

To manipulate the price oracle, we will:

1. Take out a flash loan of 50 **tokenA**
2. Use the loan to manipulate TSWAP reserves
3. Take out another flash loan for a hugely reduced fee

When `maliciousFlashLoan` is called:

1. The first 50 token loan dumps onto TSWAP, manipulating prices
2. The second 50 token loan has a massively reduced fee due to the price change

### Full Exploit Code

![](https://cdn.videotap.com/xK2fynd4EnHBvr8emyyD-1501.5.png)

It's very complex but essentially:

1. Borrows 50 tokens
2. Swaps them on TSWAP, nuking the price
3. Borrows another 50 tokens for cheaper
4. Checks the fee is reduced
5. Repays everything

Running the code proves fees are drastically reduced by the attack.

## Impact

This attack allows attackers to take flash loans for extremely cheap. They circumvent the protocol's fees and essentially get free money.

We classify this as a medium severity issue. It's unlikely to be exploited in the wild due to complexity, but if it was, it could seriously compromise sustainability.

## Recommended Mitigation

The root cause is using on-chain DEX reserves to price assets. This is easily manipulated.

Instead, we recommend decentralized oracle solutions like:

- Chainlink Price Feeds
- Uniswap TWAP

These are robust against manipulation, ensuring accurate prices even during attacks.

We hope this post has provided valuable insight into advanced oracle manipulation attacks in blockchain systems. As protocols expand in complexity, deeply understanding these attacks will prove invaluable to engineers and auditors alike.
